pipeline {
    agent any
    
    environment {
        LIQUIBASE_COMMAND_URL = credentials('postgres-url')
        LIQUIBASE_COMMAND_USERNAME = credentials('postgres-user')
        LIQUIBASE_COMMAND_PASSWORD = credentials('postgres-pass')
        LIQUIBASE_LICENSE_KEY = credentials('liquibase-license')
    }
    
    stages {
        stage('Rollback Changes') {
            steps {
                sh 'liquibase flow --flow-file=liquibase.flowfile.rollback.yaml'
            }
        }
    }
    
    post {
        success {
            echo 'Database rollback completed successfully'
        }
        failure {
            echo 'Database rollback failed'
        }
    }
}